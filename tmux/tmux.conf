# tmux.conf 기본 설정 파일

# 기본 설정
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -g history-limit 20000
set -g buffer-limit 20
set -g mouse on

# vi 모드 활성화
set-window-option -g mode-keys vi

# copy-mode 내에서 vi 키 바인딩 설정
bind -T copy-mode-vi v send -X begin-selection      # 'v'로 선택 시작
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"  # 'y'로 복사
bind -T copy-mode-vi r send -X rectangle-toggle     # 'r'로 사각형 선택 모드 토글
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "pbcopy"  # 드래그 & 복사하면 클립보드로
set -g escape-time 0
set -g display-time 4000
set -g status-interval 5
set -g focus-events on

# 키 바인딩 설정
unbind C-b
set -g prefix C-e  # 프리픽스 키를 Ctrl+E로 변경
bind C-e send-prefix

# 대체 키 설정: Ctrl+h, Ctrl+j, Ctrl+k, Ctrl+l 키 바인딩 제거 (다른 프로그램과의 충돌 방지)
# bind -n C-h select-pane -L
# bind -n C-j select-pane -D
# bind -n C-k select-pane -U
# bind -n C-l select-pane -R

# 창 분할 단축키
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# 레이아웃 단축키
bind m select-layout main-horizontal  # 메인 수평 레이아웃 (하단 패널이 전체 너비 차지)
bind M select-layout main-vertical    # 메인 수직 레이아웃
bind = select-layout tiled            # 모든 패널 동일 크기
bind Space next-layout               # 다음 레이아웃으로 순환
bind r rotate-window                 # 패널 배치 회전 - 상/하 ↔ 좌/우 레이아웃 전환

# vim 스타일 이동 (프리픽스 키 + vim 키)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt + vim 키로 패널 이동 (프리픽스 키 없이)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# macOS용 옵션 키 바인딩 추가
bind -n 'M-˙' select-pane -L  # Option + h
bind -n 'M-∆' select-pane -D  # Option + j
bind -n 'M-˚' select-pane -U  # Option + k
bind -n 'M-¬' select-pane -R  # Option + l

# 창 크기 조절 (프리픽스 키 + Shift + 방향키)
bind -r H resize-pane -L 5  # 왼쪽으로 5칸 축소
bind -r J resize-pane -D 5  # 아래로 5칸 확장
bind -r K resize-pane -U 5  # 위로 5칸 확장
bind -r L resize-pane -R 5  # 오른쪽으로 5칸 확장

# 대체 창 크기 조절 (Alt + 화살표)
bind -n M-Left resize-pane -L 5   # 왼쪽으로 축소
bind -n M-Down resize-pane -D 5   # 아래로 확장
bind -n M-Up resize-pane -U 5     # 위로 확장
bind -n M-Right resize-pane -R 5  # 오른쪽으로 확장

# 패널 위치 변경 (프리픽스 키 + { 또는 })
bind '{' swap-pane -U  # 현재 패널을 이전 패널과 교체
bind '}' swap-pane -D  # 현재 패널을 다음 패널과 교체

# 패널을 새 창으로 분리 (프리픽스 키 + !)
bind ! break-pane    # 현재 패널을 새 창으로 분리

# 창 간 이동 단축키
bind -n M-n next-window     # Alt+n으로 다음 창으로 이동
bind -n M-p previous-window # Alt+p로 이전 창으로 이동
bind -n M-1 select-window -t 1  # Alt+1로 1번 창으로 이동
bind -n M-2 select-window -t 2  # Alt+2로 2번 창으로 이동
bind -n M-3 select-window -t 3  # Alt+3로 3번 창으로 이동

# macOS용 패널 위치 변경 - 수정된 버전
# swap-pane은 -D와 -U 옵션만 지원합니다 (위/아래 방향)
bind -n S-M-Down swap-pane -D  # 다음 패널과 교체
bind -n S-M-Up swap-pane -U    # 이전 패널과 교체

# macOS 특정 문자를 위한 대체 바인딩 (Option/Alt + Shift + 화살표)
# 방향이 아닌 인덱스 기반으로 구현
bind -n 'M-Ô' swap-pane -D  # Shift+Option+아래화살표 - 다음 패널과 교체
# 위쪽 화살표 바인딩은 사용자가 실제 문자를 확인 후 설정 필요
# 예시: bind -n 'M-특수문자' swap-pane -U  # Shift+Option+위화살표 - 이전 패널과 교체

# 색상 테마 (Dracula)
set -g status-style bg=colour236,fg=colour231
set -g window-status-current-style fg=colour231,bg=colour61,bold
set -g pane-border-style fg=colour236
set -g pane-active-border-style fg=colour61,bg=default

# 활성 창 강조 설정
setw -g window-active-style 'bg=#282a36'     # 활성 창 배경색
setw -g window-style 'bg=#1e1f29'           # 비활성 창 배경색(약간 어둡게)

# 상태바 설정
set -g status-left-length 50
set -g status-left "#[fg=colour231,bold] #S "
set -g status-right "#[fg=colour231,bold] %Y-%m-%d %H:%M "
set -g status-justify left

# 시작 인덱스 번호 (창, 패널)
set -g base-index 1
setw -g pane-base-index 1

# 플러그인 설치
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# resurrect 설정
set -g @resurrect-capture-pane-contents 'on'

# continuum 설정
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# 플러그인 초기화
run '~/.tmux/plugins/tpm/tpm'