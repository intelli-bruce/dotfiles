# tmux.conf 기본 설정 파일

# 기본 설정
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# UTF-8 인코딩 설정
set -gq utf8 on
set -gq status-utf8 on
set -g history-limit 20000
set -g buffer-limit 20
set -g mouse on

# vi 모드 활성화
set-window-option -g mode-keys vi

# copy-mode 내에서 vi 키 바인딩 설정
bind -T copy-mode-vi v send -X begin-selection      # 'v'로 선택 시작
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "LC_CTYPE=UTF-8 pbcopy"  # 'y'로 복사
bind -T copy-mode-vi r send -X rectangle-toggle     # 'r'로 사각형 선택 모드 토글
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "LC_CTYPE=UTF-8 pbcopy"  # 드래그 & 복사하면 클립보드로
set -g escape-time 10
set -g display-time 4000
set -g status-interval 5
set -g focus-events on

# 키 바인딩 설정
unbind C-b
set -g prefix C-Space  # 프리픽스 키를 Ctrl+Space로 변경 (더 편한 접근성)
bind C-Space send-prefix

# Alt 키를 사용한 프리픽스 없는 빠른 단축키
bind -n M-h select-pane -L    # Alt+h 왼쪽 패널로 이동
bind -n M-j select-pane -D    # Alt+j 아래 패널로 이동
bind -n M-k select-pane -U    # Alt+k 위 패널로 이동
bind -n M-l select-pane -R    # Alt+l 오른쪽 패널로 이동

# Alt+Shift 키로 패널 위치 교체 (프리픽스 불필요)
bind -n M-H swap-pane -s '{left-of}'    # Alt+Shift+h 왼쪽 패널과 교체
bind -n M-J swap-pane -s '{down-of}'    # Alt+Shift+j 아래 패널과 교체
bind -n M-K swap-pane -s '{up-of}'      # Alt+Shift+k 위 패널과 교체
bind -n M-L swap-pane -s '{right-of}'   # Alt+Shift+l 오른쪽 패널과 교체

# 패널 조인 - 현재 패널을 다른 패널과 수직/수평으로 합치기
bind -n M-V join-pane -h -t !  # Alt+V 현재 패널을 이전 창의 패널 옆에(수직) 붙이기
bind -n M-J join-pane -v -t !  # Alt+J 현재 패널을 이전 창의 패널 아래(수평) 붙이기


# 패널 그룹 이동 - 전체 레이아웃 회전
bind -n M-R rotate-window     # Alt+R 패널 배치 시계방향 회전
bind -n M-r rotate-window -D  # Alt+r 패널 배치 반시계방향 회전

# Alt 키로 창 분할 (프리픽스 불필요)
bind -n M-\\ split-window -h -c "#{pane_current_path}"  # Alt+\ 수직 분할
bind -n M-- split-window -v -c "#{pane_current_path}"   # Alt+- 수평 분할

# Alt+Ctrl 키로 패널 크기 조절 (프리픽스 불필요)
bind -n M-C-h resize-pane -L 5  # Alt+Ctrl+h 왼쪽으로 5칸 축소
bind -n M-C-j resize-pane -D 5  # Alt+Ctrl+j 아래로 5칸 확장
bind -n M-C-k resize-pane -U 5  # Alt+Ctrl+k 위로 5칸 확장
bind -n M-C-l resize-pane -R 5  # Alt+Ctrl+l 오른쪽으로 5칸 확장

# Alt 키로 패널 관리 (프리픽스 불필요)
bind -n M-x confirm-before -p "Close pane? (y/n)" kill-pane  # Alt+x 확인 후 패널 닫기
bind -n M-z resize-pane -Z # Alt+z 현재 패널 확대/축소 토글
bind -n M-! break-pane     # Alt+! 현재 패널을 새 창으로 분리
bind -n M-o select-pane -t :.+  # Alt+o 다음 패널로 순환
bind -n M-O select-pane -t :.-  # Alt+Shift+o 이전 패널로 순환
bind -n M-q display-panes  # Alt+q 패널 번호 표시
bind -n M-Space next-layout # Alt+Space 레이아웃 순환
bind -n M-= select-layout tiled # Alt+= 모든 패널 동일 크기

# Alt+숫자로 창 이동 (프리픽스 불필요)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# Alt 키로 창 관리 (프리픽스 불필요)
bind -n M-c new-window -c "#{pane_current_path}"  # Alt+c 새 창 생성
bind -n M-n previous-window # Alt+n 이전 창으로
bind -n M-p next-window     # Alt+p 다음 창으로
bind -n M-w choose-window   # Alt+w 창 목록 보기

# 복사 모드 진입 (프리픽스 불필요)
# bind -n M-n copy-mode       # Alt+n 복사 모드 진입 - window 이동으로 변경됨

# vim 스타일 스크롤 (복사 모드 자동 진입)
bind -n M-u copy-mode \; send-keys -X halfpage-up    # Alt+u 반 페이지 위로 스크롤
bind -n M-d copy-mode \; send-keys -X halfpage-down  # Alt+d 반 페이지 아래로 스크롤

# 화살표로 세밀한 스크롤 (복사 모드 자동 진입)
bind -n M-Up copy-mode \; send-keys -X -N 3 scroll-up       # Alt+↑ 3줄 위로 스크롤
bind -n M-Down copy-mode \; send-keys -X -N 3 scroll-down   # Alt+↓ 3줄 아래로 스크롤

# 대체 키 설정: Ctrl+h, Ctrl+j, Ctrl+k, Ctrl+l 키 바인딩 제거 (다른 프로그램과의 충돌 방지)
# bind -n C-h select-pane -L
# bind -n C-j select-pane -D
# bind -n C-k select-pane -U
# bind -n C-l select-pane -R

# 창 분할 단축키
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# 레이아웃 단축키
bind m select-layout main-horizontal  # 메인 수평 레이아웃 (하단 패널이 전체 너비 차지)
bind M select-layout main-vertical    # 메인 수직 레이아웃
bind = select-layout tiled            # 모든 패널 동일 크기
bind Space next-layout               # 다음 레이아웃으로 순환
bind r rotate-window                 # 패널 배치 회전 - 상/하 ↔ 좌/우 레이아웃 전환

# vim 스타일 이동 (프리픽스 키 + vim 키)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# 패널 이동은 프리픽스 키(Ctrl+Space) + vim 키(h/j/k/l)로 사용
# vim 스타일 이동은 위에 이미 설정되어 있음 (bind h select-pane -L 등)

# 추가 이동 단축키 - 방향키
bind Left select-pane -L   # 프리픽스 키 + 왼쪽 화살표
bind Down select-pane -D   # 프리픽스 키 + 아래 화살표
bind Up select-pane -U     # 프리픽스 키 + 위 화살표
bind Right select-pane -R  # 프리픽스 키 + 오른쪽 화살표

# 창 크기 조절 (프리픽스 키 + Shift + 방향키)
bind -r H resize-pane -L 5  # 왼쪽으로 5칸 축소
bind -r J resize-pane -D 5  # 아래로 5칸 확장
bind -r K resize-pane -U 5  # 위로 5칸 확장
bind -r L resize-pane -R 5  # 오른쪽으로 5칸 확장

# 창 크기 조절은 프리픽스 키(Ctrl+Space) + Shift + 방향키(H/J/K/L)로 사용
# 위에 이미 설정되어 있음 (bind -r H resize-pane -L 5 등)

# 추가 크기 조절 단축키 - 화살표
bind -r S-Left resize-pane -L 5   # 프리픽스 키 + Shift + 왼쪽 화살표
bind -r S-Down resize-pane -D 5   # 프리픽스 키 + Shift + 아래 화살표
bind -r S-Up resize-pane -U 5     # 프리픽스 키 + Shift + 위 화살표
bind -r S-Right resize-pane -R 5  # 프리픽스 키 + Shift + 오른쪽 화살표

# 패널 위치 변경 (프리픽스 키 + { 또는 })
bind '{' swap-pane -U  # 현재 패널을 이전 패널과 교체
bind '}' swap-pane -D  # 현재 패널을 다음 패널과 교체

# 패널을 새 창으로 분리 (프리픽스 키 + !)
bind ! break-pane    # 현재 패널을 새 창으로 분리

# 창 간 이동 단축키 (프리픽스 키 사용)
bind n next-window            # 프리픽스 키 + n: 다음 창으로 이동
bind p previous-window        # 프리픽스 키 + p: 이전 창으로 이동
bind 1 select-window -t 1     # 프리픽스 키 + 1: 1번 창으로 이동
bind 2 select-window -t 2     # 프리픽스 키 + 2: 2번 창으로 이동
bind 3 select-window -t 3     # 프리픽스 키 + 3: 3번 창으로 이동
bind 4 select-window -t 4     # 프리픽스 키 + 4: 4번 창으로 이동
bind 5 select-window -t 5     # 프리픽스 키 + 5: 5번 창으로 이동

# 패널 위치 변경은 프리픽스 키 + { 또는 }로 사용
# 위에 이미 설정되어 있음 (bind '{' swap-pane -U 등)

# 추가 패널 위치 변경 단축키
bind > swap-pane -D  # 프리픽스 키 + >: 다음 패널과 교체
bind < swap-pane -U  # 프리픽스 키 + <: 이전 패널과 교체

# 색상 테마 (Dracula)
set -g status-style bg=colour236,fg=colour231
set -g window-status-current-style fg=colour231,bg=colour61,bold

# 패널 테두리 설정 - 초록색 활성 테두리
set -g pane-border-style fg=colour16  # 비활성 테두리 - 검정색(투명 효과)
set -g pane-active-border-style fg=colour82,bg=default  # 밝은 초록색 테두리

# 패널 상단에 정보 표시
set -g pane-border-status top  # 패널 상단에 이름 표시
set -g pane-border-format " #{?pane_active,#[fg=colour82]● ,  }#{pane_index} #{pane_title} "

# 패널 패딩 제거
set -g window-style ''
set -g window-active-style ''

# 패널 테두리 문자 설정
set -g pane-border-lines single  # 표준 단일 선 테두리 사용
set -g pane-border-format ""    # 테두리 포맷 비우기

# 활성 창 강조 설정 (배경색 차이로 구분)
setw -g window-active-style 'bg=#282a36'     # 활성 창 배경색
setw -g window-style 'bg=#1e1f29'           # 비활성 창 배경색(약간 어둡게)

# 상태바 설정
set -g status-left-length 50
set -g status-left "#[fg=colour231,bold] #S "
set -g status-right "#[fg=colour231,bold] %Y-%m-%d %H:%M "
set -g status-justify left

# 시작 인덱스 번호 (창, 패널)
set -g base-index 1
setw -g pane-base-index 1

# 플러그인 설치
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# resurrect 설정
set -g @resurrect-capture-pane-contents 'on'

# continuum 설정
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'
set -g @continuum-boot 'on'
set -g @continuum-boot-options 'iterm'

# 플러그인 초기화 (오류 무시)
run -b '~/.tmux/plugins/tpm/tpm || true'